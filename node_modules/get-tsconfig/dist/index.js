"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var z=require("path"),H=require("fs"),I=require("module");function R(r){return r&&typeof r=="object"&&"default"in r?r:{default:r}}var l=R(z),T=R(H);function j(r){const s=/^\\\\\?\\/.test(r),n=/[^\u0000-\u0080]+/.test(r);return s||n?r:r.replace(/\\/g,"/")}function V(r,s){for(;;){const n=l.default.join(r,s);if(T.default.existsSync(n))return j(n);const e=l.default.dirname(r);if(e===r)return;r=e}}const F=/^\.{1,2}(\/.*)?$/,q=r=>j(F.test(r)?r:`./${r}`),S=r=>T.default.existsSync(r),J=r=>{try{return JSON.parse(r)}catch{}};function G(r,s){let n=r;if(n===".."&&(n+="/tsconfig.json"),n.startsWith(".")){let i=l.default.resolve(s,n);if(S(i)&&T.default.statSync(i).isFile()||!i.endsWith(".json")&&(i+=".json",S(i)))return i;throw new Error(`File '${r}' not found.`)}if(process.versions.pnp){const t=I.createRequire(typeof document>"u"?new(require("url")).URL("file:"+__filename).href:document.currentScript&&document.currentScript.src||new URL("index.js",document.baseURI).href)("pnpapi"),[a,c]=r.split("/"),f=a.startsWith("@")?`${a}/${c}`:a;if(f===r)try{const h=t.resolveRequest(`${f}/package.json`,s),w=J(T.default.readFileSync(h,"utf8"));let u=l.default.join(h,"..");if(w&&"tsconfig"in w?u=l.default.join(u,w.tsconfig):u=l.default.join(u,"tsconfig.json"),S(u))return u}catch{}else try{return t.resolveRequest(r,s,{extensions:[".json"]})}catch{}}let e=V(s,l.default.join("node_modules",n));if(e){if(T.default.statSync(e).isDirectory()){const i=l.default.join(e,"package.json");if(S(i)){const t=J(T.default.readFileSync(i,"utf8"));t&&"tsconfig"in t?e=l.default.join(e,t.tsconfig):e=l.default.join(e,"tsconfig.json")}else e=l.default.join(e,"tsconfig.json");if(S(e))return e}else if(e.endsWith(".json"))return e}if(!n.endsWith(".json")&&(n+=".json",e=V(s,l.default.join("node_modules",n)),e))return e;throw new Error(`File '${r}' not found.`)}function K(r,s){s===void 0&&(s=!1);var n=r.length,e=0,i="",t=0,a=16,c=0,f=0,h=0,w=0,u=0;function O(o,k){for(var v=0,b=0;v<o||!k;){var p=r.charCodeAt(e);if(p>=48&&p<=57)b=b*16+p-48;else if(p>=65&&p<=70)b=b*16+p-65+10;else if(p>=97&&p<=102)b=b*16+p-97+10;else break;e++,v++}return v<o&&(b=-1),b}function N(o){e=o,i="",t=0,a=16,u=0}function _(){var o=e;if(r.charCodeAt(e)===48)e++;else for(e++;e<r.length&&A(r.charCodeAt(e));)e++;if(e<r.length&&r.charCodeAt(e)===46)if(e++,e<r.length&&A(r.charCodeAt(e)))for(e++;e<r.length&&A(r.charCodeAt(e));)e++;else return u=3,r.substring(o,e);var k=e;if(e<r.length&&(r.charCodeAt(e)===69||r.charCodeAt(e)===101))if(e++,(e<r.length&&r.charCodeAt(e)===43||r.charCodeAt(e)===45)&&e++,e<r.length&&A(r.charCodeAt(e))){for(e++;e<r.length&&A(r.charCodeAt(e));)e++;k=e}else u=3;return r.substring(o,k)}function L(){for(var o="",k=e;;){if(e>=n){o+=r.substring(k,e),u=2;break}var v=r.charCodeAt(e);if(v===34){o+=r.substring(k,e),e++;break}if(v===92){if(o+=r.substring(k,e),e++,e>=n){u=2;break}var b=r.charCodeAt(e++);switch(b){case 34:o+='"';break;case 92:o+="\\";break;case 47:o+="/";break;case 98:o+="\b";break;case 102:o+="\f";break;case 110:o+=`
`;break;case 114:o+="\r";break;case 116:o+="	";break;case 117:var p=O(4,!0);p>=0?o+=String.fromCharCode(p):u=4;break;default:u=5}k=e;continue}if(v>=0&&v<=31)if(E(v)){o+=r.substring(k,e),u=2;break}else u=6;e++}return o}function y(){if(i="",u=0,t=e,f=c,w=h,e>=n)return t=n,a=17;var o=r.charCodeAt(e);if(B(o)){do e++,i+=String.fromCharCode(o),o=r.charCodeAt(e);while(B(o));return a=15}if(E(o))return e++,i+=String.fromCharCode(o),o===13&&r.charCodeAt(e)===10&&(e++,i+=`
`),c++,h=e,a=14;switch(o){case 123:return e++,a=1;case 125:return e++,a=2;case 91:return e++,a=3;case 93:return e++,a=4;case 58:return e++,a=6;case 44:return e++,a=5;case 34:return e++,i=L(),a=10;case 47:var k=e-1;if(r.charCodeAt(e+1)===47){for(e+=2;e<n&&!E(r.charCodeAt(e));)e++;return i=r.substring(k,e),a=12}if(r.charCodeAt(e+1)===42){e+=2;for(var v=n-1,b=!1;e<v;){var p=r.charCodeAt(e);if(p===42&&r.charCodeAt(e+1)===47){e+=2,b=!0;break}e++,E(p)&&(p===13&&r.charCodeAt(e)===10&&e++,c++,h=e)}return b||(e++,u=1),i=r.substring(k,e),a=13}return i+=String.fromCharCode(o),e++,a=16;case 45:if(i+=String.fromCharCode(o),e++,e===n||!A(r.charCodeAt(e)))return a=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return i+=_(),a=11;default:for(;e<n&&m(o);)e++,o=r.charCodeAt(e);if(t!==e){switch(i=r.substring(t,e),i){case"true":return a=8;case"false":return a=9;case"null":return a=7}return a=16}return i+=String.fromCharCode(o),e++,a=16}}function m(o){if(B(o)||E(o))return!1;switch(o){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function d(){var o;do o=y();while(o>=12&&o<=15);return o}return{setPosition:N,getPosition:function(){return e},scan:s?d:y,getToken:function(){return a},getTokenValue:function(){return i},getTokenOffset:function(){return t},getTokenLength:function(){return e-t},getTokenStartLine:function(){return f},getTokenStartCharacter:function(){return t-w},getTokenError:function(){return u}}}function B(r){return r===32||r===9||r===11||r===12||r===160||r===5760||r>=8192&&r<=8203||r===8239||r===8287||r===12288||r===65279}function E(r){return r===10||r===13||r===8232||r===8233}function A(r){return r>=48&&r<=57}var D;(function(r){r.DEFAULT={allowTrailingComma:!1}})(D||(D={}));function Q(r,s,n){s===void 0&&(s=[]),n===void 0&&(n=D.DEFAULT);var e=null,i=[],t=[];function a(f){Array.isArray(i)?i.push(f):e!==null&&(i[e]=f)}var c={onObjectBegin:function(){var f={};a(f),t.push(i),i=f,e=null},onObjectProperty:function(f){e=f},onObjectEnd:function(){i=t.pop()},onArrayBegin:function(){var f=[];a(f),t.push(i),i=f,e=null},onArrayEnd:function(){i=t.pop()},onLiteralValue:a,onError:function(f,h,w){s.push({error:f,offset:h,length:w})}};return X(r,c,n),i[0]}function X(r,s,n){n===void 0&&(n=D.DEFAULT);var e=K(r,!1);function i(g){return g?function(){return g(e.getTokenOffset(),e.getTokenLength(),e.getTokenStartLine(),e.getTokenStartCharacter())}:function(){return!0}}function t(g){return g?function(C){return g(C,e.getTokenOffset(),e.getTokenLength(),e.getTokenStartLine(),e.getTokenStartCharacter())}:function(){return!0}}var a=i(s.onObjectBegin),c=t(s.onObjectProperty),f=i(s.onObjectEnd),h=i(s.onArrayBegin),w=i(s.onArrayEnd),u=t(s.onLiteralValue),O=t(s.onSeparator),N=i(s.onComment),_=t(s.onError),L=n&&n.disallowComments,y=n&&n.allowTrailingComma;function m(){for(;;){var g=e.scan();switch(e.getTokenError()){case 4:d(14);break;case 5:d(15);break;case 3:d(13);break;case 1:L||d(11);break;case 2:d(12);break;case 6:d(16);break}switch(g){case 12:case 13:L?d(10):N();break;case 16:d(1);break;case 15:case 14:break;default:return g}}}function d(g,C,P){if(C===void 0&&(C=[]),P===void 0&&(P=[]),_(g),C.length+P.length>0)for(var $=e.getToken();$!==17;){if(C.indexOf($)!==-1){m();break}else if(P.indexOf($)!==-1)break;$=m()}}function o(g){var C=e.getTokenValue();return g?u(C):c(C),m(),!0}function k(){switch(e.getToken()){case 11:var g=e.getTokenValue(),C=Number(g);isNaN(C)&&(d(2),C=0),u(C);break;case 7:u(null);break;case 8:u(!0);break;case 9:u(!1);break;default:return!1}return m(),!0}function v(){return e.getToken()!==10?(d(3,[],[2,5]),!1):(o(!1),e.getToken()===6?(O(":"),m(),U()||d(4,[],[2,5])):d(5,[],[2,5]),!0)}function b(){a(),m();for(var g=!1;e.getToken()!==2&&e.getToken()!==17;){if(e.getToken()===5){if(g||d(4,[],[]),O(","),m(),e.getToken()===2&&y)break}else g&&d(6,[],[]);v()||d(4,[],[2,5]),g=!0}return f(),e.getToken()!==2?d(7,[2],[]):m(),!0}function p(){h(),m();for(var g=!1;e.getToken()!==4&&e.getToken()!==17;){if(e.getToken()===5){if(g||d(4,[],[]),O(","),m(),e.getToken()===4&&y)break}else g&&d(6,[],[]);U()||d(4,[],[4,5]),g=!0}return w(),e.getToken()!==4?d(8,[4],[]):m(),!0}function U(){switch(e.getToken()){case 3:return p();case 1:return b();case 10:return o(!0);default:return k()}}return m(),e.getToken()===17?n.allowEmptyContent?!0:(d(4,[],[]),!1):U()?(e.getToken()!==17&&d(9,[],[]),!0):(d(4,[],[]),!1)}var Y=Q;function W(r){var s;let n;try{n=T.default.realpathSync(r)}catch{throw new Error(`Cannot resolve tsconfig at path: ${r}`)}const e=l.default.dirname(n),i=T.default.readFileSync(n,"utf8").trim();let t={};if(i&&(t=Y(i),!t||typeof t!="object"))throw new SyntaxError(`Failed to parse tsconfig at: ${r}`);if(t.extends){const a=G(t.extends,e),c=W(a);if(delete c.references,(s=c.compilerOptions)!=null&&s.baseUrl){const{compilerOptions:h}=c;h.baseUrl=l.default.relative(e,l.default.join(l.default.dirname(a),h.baseUrl))||"./"}c.files&&(c.files=c.files.map(h=>l.default.relative(e,l.default.join(l.default.dirname(a),h)))),c.include&&(c.include=c.include.map(h=>l.default.relative(e,l.default.join(l.default.dirname(a),h)))),delete t.extends;const f={...c,...t,compilerOptions:{...c.compilerOptions,...t.compilerOptions}};c.watchOptions&&(f.watchOptions={...c.watchOptions,...t.watchOptions}),t=f}if(t.compilerOptions){const{compilerOptions:a}=t;a.baseUrl&&(a.baseUrl=q(a.baseUrl)),a.outDir&&(Array.isArray(t.exclude)||(t.exclude=[]),t.exclude.push(a.outDir),a.outDir=q(a.outDir))}if(t.files&&(t.files=t.files.map(q)),t.include&&(t.include=t.include.map(j)),t.watchOptions){const{watchOptions:a}=t;a.excludeDirectories&&(a.excludeDirectories=a.excludeDirectories.map(c=>j(l.default.resolve(e,c))))}return t}function Z(r=process.cwd(),s="tsconfig.json"){const n=V(r,s);if(!n)return null;const e=W(n);return{path:n,config:e}}const x=/\*/g,M=(r,s)=>{const n=r.match(x);if(n&&n.length>1)throw new Error(s)};function ee(r){if(r.includes("*")){const[s,n]=r.split("*");return{prefix:s,suffix:n}}return r}const re=({prefix:r,suffix:s},n)=>n.startsWith(r)&&n.endsWith(s);function ne(r,s,n){return Object.entries(r).map(([e,i])=>(M(e,`Pattern '${e}' can have at most one '*' character.`),{pattern:ee(e),substitutions:i.map(t=>{if(M(t,`Substitution '${t}' in pattern '${e}' can have at most one '*' character.`),!s&&!F.test(t))throw new Error("Non-relative paths are not allowed when 'baseUrl' is not set. Did you forget a leading './'?");return l.default.join(n,t)})}))}function te(r){if(!r.config.compilerOptions)return null;const{baseUrl:s,paths:n}=r.config.compilerOptions;if(!s&&!n)return null;const e=l.default.resolve(l.default.dirname(r.path),s||"."),i=n?ne(n,s,e):[];return function(a){if(F.test(a))return[];const c=[];for(const u of i){if(u.pattern===a)return u.substitutions.map(j);typeof u.pattern!="string"&&c.push(u)}let f,h=-1;for(const u of c)re(u.pattern,a)&&u.pattern.prefix.length>h&&(h=u.pattern.prefix.length,f=u);if(!f)return s?[j(l.default.join(e,a))]:[];const w=a.slice(f.pattern.prefix.length,a.length-f.pattern.suffix.length);return f.substitutions.map(u=>j(u.replace("*",w)))}}exports.createPathsMatcher=te,exports.getTsconfig=Z,exports.parseTsconfig=W;

import l from"path";import T from"fs";import{createRequire as _}from"module";function j(r){const s=/^\\\\\?\\/.test(r),n=/[^\u0000-\u0080]+/.test(r);return s||n?r:r.replace(/\\/g,"/")}function B(r,s){for(;;){const n=l.join(r,s);if(T.existsSync(n))return j(n);const e=l.dirname(r);if(e===r)return;r=e}}const U=/^\.{1,2}(\/.*)?$/,W=r=>j(U.test(r)?r:`./${r}`),S=r=>T.existsSync(r),M=r=>{try{return JSON.parse(r)}catch{}};function z(r,s){let n=r;if(n===".."&&(n+="/tsconfig.json"),n.startsWith(".")){let o=l.resolve(s,n);if(S(o)&&T.statSync(o).isFile()||!o.endsWith(".json")&&(o+=".json",S(o)))return o;throw new Error(`File '${r}' not found.`)}if(process.versions.pnp){const t=_(import.meta.url)("pnpapi"),[a,u]=r.split("/"),f=a.startsWith("@")?`${a}/${u}`:a;if(f===r)try{const h=t.resolveRequest(`${f}/package.json`,s),w=M(T.readFileSync(h,"utf8"));let c=l.join(h,"..");if(w&&"tsconfig"in w?c=l.join(c,w.tsconfig):c=l.join(c,"tsconfig.json"),S(c))return c}catch{}else try{return t.resolveRequest(r,s,{extensions:[".json"]})}catch{}}let e=B(s,l.join("node_modules",n));if(e){if(T.statSync(e).isDirectory()){const o=l.join(e,"package.json");if(S(o)){const t=M(T.readFileSync(o,"utf8"));t&&"tsconfig"in t?e=l.join(e,t.tsconfig):e=l.join(e,"tsconfig.json")}else e=l.join(e,"tsconfig.json");if(S(e))return e}else if(e.endsWith(".json"))return e}if(!n.endsWith(".json")&&(n+=".json",e=B(s,l.join("node_modules",n)),e))return e;throw new Error(`File '${r}' not found.`)}function H(r,s){s===void 0&&(s=!1);var n=r.length,e=0,o="",t=0,a=16,u=0,f=0,h=0,w=0,c=0;function O(i,k){for(var C=0,b=0;C<i||!k;){var p=r.charCodeAt(e);if(p>=48&&p<=57)b=b*16+p-48;else if(p>=65&&p<=70)b=b*16+p-65+10;else if(p>=97&&p<=102)b=b*16+p-97+10;else break;e++,C++}return C<i&&(b=-1),b}function $(i){e=i,o="",t=0,a=16,c=0}function V(){var i=e;if(r.charCodeAt(e)===48)e++;else for(e++;e<r.length&&A(r.charCodeAt(e));)e++;if(e<r.length&&r.charCodeAt(e)===46)if(e++,e<r.length&&A(r.charCodeAt(e)))for(e++;e<r.length&&A(r.charCodeAt(e));)e++;else return c=3,r.substring(i,e);var k=e;if(e<r.length&&(r.charCodeAt(e)===69||r.charCodeAt(e)===101))if(e++,(e<r.length&&r.charCodeAt(e)===43||r.charCodeAt(e)===45)&&e++,e<r.length&&A(r.charCodeAt(e))){for(e++;e<r.length&&A(r.charCodeAt(e));)e++;k=e}else c=3;return r.substring(i,k)}function L(){for(var i="",k=e;;){if(e>=n){i+=r.substring(k,e),c=2;break}var C=r.charCodeAt(e);if(C===34){i+=r.substring(k,e),e++;break}if(C===92){if(i+=r.substring(k,e),e++,e>=n){c=2;break}var b=r.charCodeAt(e++);switch(b){case 34:i+='"';break;case 92:i+="\\";break;case 47:i+="/";break;case 98:i+="\b";break;case 102:i+="\f";break;case 110:i+=`
`;break;case 114:i+="\r";break;case 116:i+="	";break;case 117:var p=O(4,!0);p>=0?i+=String.fromCharCode(p):c=4;break;default:c=5}k=e;continue}if(C>=0&&C<=31)if(E(C)){i+=r.substring(k,e),c=2;break}else c=6;e++}return i}function y(){if(o="",c=0,t=e,f=u,w=h,e>=n)return t=n,a=17;var i=r.charCodeAt(e);if(J(i)){do e++,o+=String.fromCharCode(i),i=r.charCodeAt(e);while(J(i));return a=15}if(E(i))return e++,o+=String.fromCharCode(i),i===13&&r.charCodeAt(e)===10&&(e++,o+=`
`),u++,h=e,a=14;switch(i){case 123:return e++,a=1;case 125:return e++,a=2;case 91:return e++,a=3;case 93:return e++,a=4;case 58:return e++,a=6;case 44:return e++,a=5;case 34:return e++,o=L(),a=10;case 47:var k=e-1;if(r.charCodeAt(e+1)===47){for(e+=2;e<n&&!E(r.charCodeAt(e));)e++;return o=r.substring(k,e),a=12}if(r.charCodeAt(e+1)===42){e+=2;for(var C=n-1,b=!1;e<C;){var p=r.charCodeAt(e);if(p===42&&r.charCodeAt(e+1)===47){e+=2,b=!0;break}e++,E(p)&&(p===13&&r.charCodeAt(e)===10&&e++,u++,h=e)}return b||(e++,c=1),o=r.substring(k,e),a=13}return o+=String.fromCharCode(i),e++,a=16;case 45:if(o+=String.fromCharCode(i),e++,e===n||!A(r.charCodeAt(e)))return a=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return o+=V(),a=11;default:for(;e<n&&m(i);)e++,i=r.charCodeAt(e);if(t!==e){switch(o=r.substring(t,e),o){case"true":return a=8;case"false":return a=9;case"null":return a=7}return a=16}return o+=String.fromCharCode(i),e++,a=16}}function m(i){if(J(i)||E(i))return!1;switch(i){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function g(){var i;do i=y();while(i>=12&&i<=15);return i}return{setPosition:$,getPosition:function(){return e},scan:s?g:y,getToken:function(){return a},getTokenValue:function(){return o},getTokenOffset:function(){return t},getTokenLength:function(){return e-t},getTokenStartLine:function(){return f},getTokenStartCharacter:function(){return t-w},getTokenError:function(){return c}}}function J(r){return r===32||r===9||r===11||r===12||r===160||r===5760||r>=8192&&r<=8203||r===8239||r===8287||r===12288||r===65279}function E(r){return r===10||r===13||r===8232||r===8233}function A(r){return r>=48&&r<=57}var N;(function(r){r.DEFAULT={allowTrailingComma:!1}})(N||(N={}));function G(r,s,n){s===void 0&&(s=[]),n===void 0&&(n=N.DEFAULT);var e=null,o=[],t=[];function a(f){Array.isArray(o)?o.push(f):e!==null&&(o[e]=f)}var u={onObjectBegin:function(){var f={};a(f),t.push(o),o=f,e=null},onObjectProperty:function(f){e=f},onObjectEnd:function(){o=t.pop()},onArrayBegin:function(){var f=[];a(f),t.push(o),o=f,e=null},onArrayEnd:function(){o=t.pop()},onLiteralValue:a,onError:function(f,h,w){s.push({error:f,offset:h,length:w})}};return I(r,u,n),o[0]}function I(r,s,n){n===void 0&&(n=N.DEFAULT);var e=H(r,!1);function o(d){return d?function(){return d(e.getTokenOffset(),e.getTokenLength(),e.getTokenStartLine(),e.getTokenStartCharacter())}:function(){return!0}}function t(d){return d?function(v){return d(v,e.getTokenOffset(),e.getTokenLength(),e.getTokenStartLine(),e.getTokenStartCharacter())}:function(){return!0}}var a=o(s.onObjectBegin),u=t(s.onObjectProperty),f=o(s.onObjectEnd),h=o(s.onArrayBegin),w=o(s.onArrayEnd),c=t(s.onLiteralValue),O=t(s.onSeparator),$=o(s.onComment),V=t(s.onError),L=n&&n.disallowComments,y=n&&n.allowTrailingComma;function m(){for(;;){var d=e.scan();switch(e.getTokenError()){case 4:g(14);break;case 5:g(15);break;case 3:g(13);break;case 1:L||g(11);break;case 2:g(12);break;case 6:g(16);break}switch(d){case 12:case 13:L?g(10):$();break;case 16:g(1);break;case 15:case 14:break;default:return d}}}function g(d,v,P){if(v===void 0&&(v=[]),P===void 0&&(P=[]),V(d),v.length+P.length>0)for(var D=e.getToken();D!==17;){if(v.indexOf(D)!==-1){m();break}else if(P.indexOf(D)!==-1)break;D=m()}}function i(d){var v=e.getTokenValue();return d?c(v):u(v),m(),!0}function k(){switch(e.getToken()){case 11:var d=e.getTokenValue(),v=Number(d);isNaN(v)&&(g(2),v=0),c(v);break;case 7:c(null);break;case 8:c(!0);break;case 9:c(!1);break;default:return!1}return m(),!0}function C(){return e.getToken()!==10?(g(3,[],[2,5]),!1):(i(!1),e.getToken()===6?(O(":"),m(),F()||g(4,[],[2,5])):g(5,[],[2,5]),!0)}function b(){a(),m();for(var d=!1;e.getToken()!==2&&e.getToken()!==17;){if(e.getToken()===5){if(d||g(4,[],[]),O(","),m(),e.getToken()===2&&y)break}else d&&g(6,[],[]);C()||g(4,[],[2,5]),d=!0}return f(),e.getToken()!==2?g(7,[2],[]):m(),!0}function p(){h(),m();for(var d=!1;e.getToken()!==4&&e.getToken()!==17;){if(e.getToken()===5){if(d||g(4,[],[]),O(","),m(),e.getToken()===4&&y)break}else d&&g(6,[],[]);F()||g(4,[],[4,5]),d=!0}return w(),e.getToken()!==4?g(8,[4],[]):m(),!0}function F(){switch(e.getToken()){case 3:return p();case 1:return b();case 10:return i(!0);default:return k()}}return m(),e.getToken()===17?n.allowEmptyContent?!0:(g(4,[],[]),!1):F()?(e.getToken()!==17&&g(9,[],[]),!0):(g(4,[],[]),!1)}var K=G;function q(r){var s;let n;try{n=T.realpathSync(r)}catch{throw new Error(`Cannot resolve tsconfig at path: ${r}`)}const e=l.dirname(n),o=T.readFileSync(n,"utf8").trim();let t={};if(o&&(t=K(o),!t||typeof t!="object"))throw new SyntaxError(`Failed to parse tsconfig at: ${r}`);if(t.extends){const a=z(t.extends,e),u=q(a);if(delete u.references,(s=u.compilerOptions)!=null&&s.baseUrl){const{compilerOptions:h}=u;h.baseUrl=l.relative(e,l.join(l.dirname(a),h.baseUrl))||"./"}u.files&&(u.files=u.files.map(h=>l.relative(e,l.join(l.dirname(a),h)))),u.include&&(u.include=u.include.map(h=>l.relative(e,l.join(l.dirname(a),h)))),delete t.extends;const f={...u,...t,compilerOptions:{...u.compilerOptions,...t.compilerOptions}};u.watchOptions&&(f.watchOptions={...u.watchOptions,...t.watchOptions}),t=f}if(t.compilerOptions){const{compilerOptions:a}=t;a.baseUrl&&(a.baseUrl=W(a.baseUrl)),a.outDir&&(Array.isArray(t.exclude)||(t.exclude=[]),t.exclude.push(a.outDir),a.outDir=W(a.outDir))}if(t.files&&(t.files=t.files.map(W)),t.include&&(t.include=t.include.map(j)),t.watchOptions){const{watchOptions:a}=t;a.excludeDirectories&&(a.excludeDirectories=a.excludeDirectories.map(u=>j(l.resolve(e,u))))}return t}function Q(r=process.cwd(),s="tsconfig.json"){const n=B(r,s);if(!n)return null;const e=q(n);return{path:n,config:e}}const X=/\*/g,R=(r,s)=>{const n=r.match(X);if(n&&n.length>1)throw new Error(s)};function Y(r){if(r.includes("*")){const[s,n]=r.split("*");return{prefix:s,suffix:n}}return r}const Z=({prefix:r,suffix:s},n)=>n.startsWith(r)&&n.endsWith(s);function x(r,s,n){return Object.entries(r).map(([e,o])=>(R(e,`Pattern '${e}' can have at most one '*' character.`),{pattern:Y(e),substitutions:o.map(t=>{if(R(t,`Substitution '${t}' in pattern '${e}' can have at most one '*' character.`),!s&&!U.test(t))throw new Error("Non-relative paths are not allowed when 'baseUrl' is not set. Did you forget a leading './'?");return l.join(n,t)})}))}function ee(r){if(!r.config.compilerOptions)return null;const{baseUrl:s,paths:n}=r.config.compilerOptions;if(!s&&!n)return null;const e=l.resolve(l.dirname(r.path),s||"."),o=n?x(n,s,e):[];return function(a){if(U.test(a))return[];const u=[];for(const c of o){if(c.pattern===a)return c.substitutions.map(j);typeof c.pattern!="string"&&u.push(c)}let f,h=-1;for(const c of u)Z(c.pattern,a)&&c.pattern.prefix.length>h&&(h=c.pattern.prefix.length,f=c);if(!f)return s?[j(l.join(e,a))]:[];const w=a.slice(f.pattern.prefix.length,a.length-f.pattern.suffix.length);return f.substitutions.map(c=>j(c.replace("*",w)))}}export{ee as createPathsMatcher,Q as getTsconfig,q as parseTsconfig};
